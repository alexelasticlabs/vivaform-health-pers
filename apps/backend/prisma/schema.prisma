generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SubscriptionTier {
  FREE
  PREMIUM
}

enum UserRole {
  USER
  ADMIN
}

enum ActivityLevel {
  SEDENTARY
  LIGHT
  MODERATE
  ACTIVE
  ATHLETE
}

enum GoalType {
  LOSE_WEIGHT
  MAINTAIN_WEIGHT
  GAIN_WEIGHT
}

model User {
  id            String           @id @default(cuid())
  email         String           @unique
  passwordHash  String
  name          String?
  role          UserRole         @default(USER)
  tier          SubscriptionTier @default(FREE)
  emailVerified Boolean          @default(false)
  pushToken     String?          // Expo Push Token for notifications
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  profile       Profile?
  nutrition     NutritionEntry[]
  water         WaterEntry[]
  weight        WeightEntry[]
  recommendations Recommendation[]
  subscription  Subscription?
  articles      Article[]
}

model Profile {
  id               String        @id @default(cuid())
  user             User          @relation(fields: [userId], references: [id])
  userId           String        @unique
  gender           String?
  birthDate        DateTime?
  heightCm         Int?
  currentWeightKg  Float?
  targetWeightKg   Float?
  goal             GoalType?
  activityLevel    ActivityLevel?
  dietaryPreferences String[]
  
  // Quiz-specific fields
  dietPlan              String?
  mealsPerDay           Int?
  skipBreakfast         Boolean?
  snackBetweenMeals     Boolean?
  fastFoodFrequency     String?
  cookAtHomeFrequency   String?
  sleepHours            Float?
  exerciseRegularly     Boolean?
  wakeUpTime            String?
  dinnerTime            String?
  foodAllergies         String[]
  avoidedFoods          String[]
  mealComplexity        String?
  tryNewFoods           Boolean?
  cookingTimeMinutes    Int?
  eatWhenStressed       Boolean?
  mainMotivation        String?
  stressLevel           Int?
  comfortSource         String?
  routineConfidence     Int?
  dailyWaterMl          Int?
  wantReminders         Boolean?
  trackActivity         Boolean?
  connectHealthApp      Boolean?
  theme                 String?
  
  // Calculated fields
  bmi                   Float?
  bmr                   Float?
  tdee                  Float?
  recommendedCalories   Float?
  
  updatedAt        DateTime      @updatedAt
  createdAt        DateTime      @default(now())
}

model NutritionEntry {
  id          String   @id @default(cuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  date        DateTime
  mealType    String
  food        String
  calories    Int
  protein     Float
  fat         Float
  carbs       Float
  createdAt   DateTime @default(now())

  @@index([userId, date])
}

model WaterEntry {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  date      DateTime
  amountMl  Int
  createdAt DateTime @default(now())

  @@index([userId, date])
}

model WeightEntry {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  date      DateTime
  weightKg  Float
  note      String?
  createdAt DateTime @default(now())

  @@index([userId, date])
}

model Recommendation {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  date      DateTime @default(now())
  title     String
  body      String
  createdAt DateTime @default(now())

  @@index([userId, date])
}

model Subscription {
  id                 String   @id @default(cuid())
  user               User     @relation(fields: [userId], references: [id])
  userId             String   @unique
  stripeCustomerId   String
  stripeSubscription String   @unique
  priceId            String
  currentPeriodEnd   DateTime
  status             String
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model MealTemplate {
  id                   String   @id @default(cuid())
  name                 String
  category             String   // "breakfast", "lunch", "dinner", "snack"
  dietPlans            String[] // ["mediterranean", "carnivore", "anti-inflammatory"]
  calories             Int
  protein              Float    // grams
  fat                  Float    // grams
  carbs                Float    // grams
  cookingTimeMinutes   Int
  complexity           String   // "simple", "medium", "complex"
  allergens            String[] // ["nuts", "dairy", "gluten", "eggs", "fish", "shellfish", "soy"]
  avoidedIngredients   String[] // ["meat", "dairy", "gluten", etc.]
  ingredients          String[]
  instructions         String?
  servings             Int      @default(1)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@index([category])
  @@index([dietPlans])
}

model FoodItem {
  id           String  @id @default(cuid())
  name         String
  brand        String?
  category     String
  caloriesPer100g Int
  proteinPer100g  Float
  fatPer100g      Float
  carbsPer100g    Float
  fiberPer100g    Float?
  sugarPer100g    Float?
  servingSize     String  // "100g", "1 piece", "1 cup", etc.
  servingSizeGrams Float? // weight of serving in grams (if applicable)
  barcode      String? // for future barcode scanning
  verified     Boolean @default(false) // admin-verified entries
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([name])
  @@index([category])
  @@index([barcode])
}

model Article {
  id           String   @id @default(cuid())
  title        String
  slug         String   @unique
  excerpt      String?
  content      String   @db.Text
  category     String   // "Nutrition", "Fitness", "Mental Health", "Recipes", "Tips"
  coverImage   String?
  tags         String[] @default([])
  published    Boolean  @default(false)
  publishedAt  DateTime?
  viewCount    Int      @default(0)
  author       User     @relation(fields: [authorId], references: [id])
  authorId     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([slug])
  @@index([category])
  @@index([published])
  @@index([authorId])
}
